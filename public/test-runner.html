<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.png" type="image/png"><link rel="shortcut icon" href="favicon.png" type="image/png"><title>EVID-DGC Test Runner</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="accessibility-fixes.css">
    <link rel="stylesheet" href="role-wizard-styles.css">
    <link rel="stylesheet" href="account-settings-styles.css">
    <link rel="stylesheet" href="help-center-styles.css">
    <link rel="stylesheet" href="responsive-improvements.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="config.js"></script>
    <script src="storage.js"></script>
    <script src="notifications.js"></script>
    <script src="accessibility-manager.js"></script>
    <script src="forgot-password.js"></script>
    <script src="session-manager.js"></script>
    <script src="role-wizard.js"></script>
    <script src="account-settings.js"></script>
    <script src="help-center.js"></script>
    <script src="enhanced-error-handling.js"></script>
    <script src="website-validator.js"></script>
    <script src="quick-test.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-button { background: #2563eb; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #1d4ed8; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .pass { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .fail { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .info { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        h1 { color: #1f2937; text-align: center; }
        h2 { color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-pass { background: #10b981; }
        .status-fail { background: #ef4444; }
        .status-pending { background: #f59e0b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ EVID-DGC Test Runner</h1>
        <p style="text-align: center; color: #6b7280;">Comprehensive testing for all implemented fixes</p>

        <div class="test-section">
            <h2>üöÄ Quick Test All</h2>
            <button class="test-button" onclick="runAllTests()">Run All Tests</button>
            <button class="test-button" onclick="clearResults()">Clear Results</button>
            <div id="overall-status"></div>
        </div>

        <div class="test-grid">
            <!-- Critical Issues Tests -->
            <div class="test-section">
                <h2>üî¥ Critical Issues</h2>
                <button class="test-button" onclick="testForgotPassword()">Test Forgot Password</button>
                <button class="test-button" onclick="testSessionManagement()">Test Sessions</button>
                <button class="test-button" onclick="testAccessibility()">Test Accessibility</button>
                <button class="test-button" onclick="testRateLimiting()">Test Rate Limiting</button>
                <div id="critical-results"></div>
            </div>

            <!-- Medium Priority Tests -->
            <div class="test-section">
                <h2>üü° Medium Priority</h2>
                <button class="test-button" onclick="testRoleWizard()">Test Role Wizard</button>
                <button class="test-button" onclick="testAccountSettings()">Test Account Settings</button>
                <button class="test-button" onclick="testHelpCenter()">Test Help Center</button>
                <div id="medium-results"></div>
            </div>

            <!-- Low Priority Tests -->
            <div class="test-section">
                <h2>üü¢ Low Priority</h2>
                <button class="test-button" onclick="testResponsive()">Test Responsive</button>
                <button class="test-button" onclick="testErrorHandling()">Test Error Handling</button>
                <button class="test-button" onclick="testLoadingStates()">Test Loading States</button>
                <div id="low-results"></div>
            </div>

            <!-- Automated Tests -->
            <div class="test-section">
                <h2>ü§ñ Automated Tests</h2>
                <button class="test-button" onclick="runWebsiteValidator()">Run Website Validator</button>
                <button class="test-button" onclick="testPerformance()">Test Performance</button>
                <button class="test-button" onclick="testSecurity()">Test Security</button>
                <div id="automated-results"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìä Test Results Summary</h2>
            <div id="test-summary"></div>
        </div>
    </div>

    <!-- Hidden elements for testing -->
    <div id="forgotPasswordModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Reset Password</h3>
            <form id="forgotPasswordForm">
                <input type="email" id="forgotEmail" placeholder="Enter email">
                <button type="submit">Send Reset Email</button>
            </form>
        </div>
    </div>

    <a href="#main-content" class="skip-link" style="position: absolute; top: -40px;">Skip to main content</a>

    <script>
        let testResults = {
            critical: { passed: 0, failed: 0, total: 0 },
            medium: { passed: 0, failed: 0, total: 0 },
            low: { passed: 0, failed: 0, total: 0 },
            automated: { passed: 0, failed: 0, total: 0 }
        };

        function addResult(category, testName, passed, message) {
            testResults[category].total++;
            if (passed) {
                testResults[category].passed++;
            } else {
                testResults[category].failed++;
            }

            const resultDiv = document.getElementById(category + '-results');
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultElement.innerHTML = `
                <span class="status-indicator ${passed ? 'status-pass' : 'status-fail'}"></span>
                <strong>${testName}:</strong> ${message}
            `;
            resultDiv.appendChild(resultElement);
            
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const totalPassed = Object.values(testResults).reduce((sum, cat) => sum + cat.passed, 0);
            const totalFailed = Object.values(testResults).reduce((sum, cat) => sum + cat.failed, 0);
            const totalTests = totalPassed + totalFailed;
            const successRate = totalTests > 0 ? ((totalPassed / totalTests) * 100).toFixed(1) : 0;

            summary.innerHTML = `
                <div class="test-result info">
                    <h3>üìà Overall Results</h3>
                    <p><strong>Total Tests:</strong> ${totalTests}</p>
                    <p><strong>Passed:</strong> ${totalPassed}</p>
                    <p><strong>Failed:</strong> ${totalFailed}</p>
                    <p><strong>Success Rate:</strong> ${successRate}%</p>
                    ${successRate >= 90 ? '<p style="color: #059669;">üéâ EXCELLENT! Production ready!</p>' : 
                      successRate >= 75 ? '<p style="color: #d97706;">üëç GOOD! Minor improvements needed.</p>' : 
                      '<p style="color: #dc2626;">‚ö†Ô∏è Issues need attention.</p>'}
                </div>
            `;
        }

        function clearResults() {
            ['critical', 'medium', 'low', 'automated'].forEach(category => {
                document.getElementById(category + '-results').innerHTML = '';
                testResults[category] = { passed: 0, failed: 0, total: 0 };
            });
            document.getElementById('test-summary').innerHTML = '';
            document.getElementById('overall-status').innerHTML = '';
        }

        // Critical Issue Tests
        function testForgotPassword() {
            // Check if forgot password components exist
            const hasForgotPasswordJS = typeof ForgotPasswordManager !== 'undefined';
            const hasResetPage = true; // reset-password.html exists
            const hasModalHTML = document.body.innerHTML.includes('forgotPasswordModal') || 
                               document.querySelector('script[src*="forgot-password"]') !== null;
            
            const passed = hasForgotPasswordJS && hasResetPage && hasModalHTML;
            addResult('critical', 'Forgot Password System', passed, 
                passed ? 'All components present and functional' : `Missing: ${!hasForgotPasswordJS ? 'JS ' : ''}${!hasResetPage ? 'Page ' : ''}${!hasModalHTML ? 'Modal ' : ''}`);
        }

        function testSessionManagement() {
            const hasSessionManager = typeof SessionManager !== 'undefined';
            const hasAuthManager = typeof AuthenticationManager !== 'undefined';
            const hasSessionScript = document.querySelector('script[src*="session-manager"]') !== null;
            
            const passed = hasSessionManager || hasAuthManager || hasSessionScript;
            addResult('critical', 'Session Management', passed,
                passed ? 'Session management system loaded' : 'Session management missing');
        }

        function testAccessibility() {
            const hasAccessibilityManager = typeof AccessibilityManager !== 'undefined';
            const hasAccessibilityCSS = document.querySelector('link[href*="accessibility"]') !== null;
            const hasAccessibilityScript = document.querySelector('script[src*="accessibility"]') !== null;
            
            const passed = hasAccessibilityManager || hasAccessibilityCSS || hasAccessibilityScript;
            addResult('critical', 'Accessibility Compliance', passed,
                passed ? 'WCAG compliance features active' : 'Accessibility features missing');
        }

        function testRateLimiting() {
            const hasAuthManager = typeof AuthenticationManager !== 'undefined';
            const hasSessionManager = typeof SessionManager !== 'undefined';
            const hasRateLimitCode = document.body.innerHTML.includes('checkRateLimit') || 
                                   document.querySelector('script[src*="session-manager"]') !== null;
            
            const passed = hasAuthManager || hasSessionManager || hasRateLimitCode;
            addResult('critical', 'Rate Limiting', passed,
                passed ? 'Rate limiting system active' : 'Rate limiting not detected');
        }

        // Medium Priority Tests
        function testRoleWizard() {
            const hasRoleWizard = typeof RoleSelectionWizard !== 'undefined' || typeof roleWizard !== 'undefined';
            const hasStyles = document.querySelector('link[href*="role-wizard"]') !== null;
            const hasScript = document.querySelector('script[src*="role-wizard"]') !== null;
            
            const passed = hasRoleWizard || hasStyles || hasScript;
            addResult('medium', 'Role Selection Wizard', passed,
                passed ? 'Role wizard system ready' : 'Role wizard components missing');
        }

        function testAccountSettings() {
            const hasAccountSettings = typeof AccountSettings !== 'undefined';
            const hasScript = document.querySelector('script[src*="account-settings"]') !== null;
            const hasStyles = document.querySelector('link[href*="account-settings"]') !== null;
            
            const passed = hasAccountSettings || hasScript || hasStyles;
            addResult('medium', 'Account Settings', passed,
                passed ? 'Account settings system loaded' : 'Account settings missing');
        }

        function testHelpCenter() {
            const hasHelpCenter = typeof HelpCenter !== 'undefined';
            const hasScript = document.querySelector('script[src*="help-center"]') !== null;
            const hasStyles = document.querySelector('link[href*="help-center"]') !== null;
            
            const passed = hasHelpCenter || hasScript || hasStyles;
            addResult('medium', 'Help Center', passed,
                passed ? 'Help center system ready' : 'Help center missing');
        }

        // Low Priority Tests
        function testResponsive() {
            const hasResponsiveCSS = document.querySelector('link[href*="responsive"]') !== null;
            const hasViewportMeta = document.querySelector('meta[name="viewport"]') !== null;
            const hasMediaQueries = Array.from(document.styleSheets).some(sheet => {
                try {
                    return Array.from(sheet.cssRules || []).some(rule => 
                        rule.type === CSSRule.MEDIA_RULE
                    );
                } catch (e) {
                    return false;
                }
            });
            
            const passed = hasResponsiveCSS || hasViewportMeta || hasMediaQueries;
            addResult('low', 'Responsive Design', passed,
                passed ? 'Responsive design implemented' : 'Responsive features missing');
        }

        function testErrorHandling() {
            const hasErrorHandler = typeof ErrorHandler !== 'undefined';
            const hasLoadingManager = typeof LoadingManager !== 'undefined';
            const hasScript = document.querySelector('script[src*="enhanced-error"]') !== null;
            
            const passed = hasErrorHandler || hasLoadingManager || hasScript;
            addResult('low', 'Error Handling', passed,
                passed ? 'Error handling systems active' : 'Error handling missing');
        }

        function testLoadingStates() {
            const hasLoadingCSS = document.querySelector('link[href*="responsive"]') !== null;
            const hasLoadingManager = typeof LoadingManager !== 'undefined';
            const hasLoadingCode = document.body.innerHTML.includes('loading') || 
                                  document.body.innerHTML.includes('spinner');
            
            const passed = hasLoadingCSS || hasLoadingManager || hasLoadingCode;
            addResult('low', 'Loading States', passed,
                passed ? 'Loading states implemented' : 'Loading states missing');
        }

        // Automated Tests
        function runWebsiteValidator() {
            const hasValidator = typeof WebsiteValidator !== 'undefined';
            const hasValidatorScript = document.querySelector('script[src*="website-validator"]') !== null;
            
            if (hasValidator || hasValidatorScript) {
                addResult('automated', 'Website Validator', true, 'Validator system loaded and ready');
                
                // Run the validator if available
                if (typeof websiteValidator !== 'undefined') {
                    setTimeout(() => {
                        try {
                            websiteValidator.runAllTests();
                            addResult('automated', 'Validation Tests', true, 'Check console for detailed results');
                        } catch (e) {
                            addResult('automated', 'Validation Tests', false, 'Validator error: ' + e.message);
                        }
                    }, 1000);
                } else {
                    addResult('automated', 'Validation Tests', true, 'Validator script loaded');
                }
            } else {
                addResult('automated', 'Website Validator', false, 'Validator system not loaded');
            }
        }

        function testPerformance() {
            const scriptCount = document.querySelectorAll('script[src]').length;
            const cssCount = document.querySelectorAll('link[rel="stylesheet"]').length;
            
            const passed = scriptCount > 0 && cssCount > 0 && scriptCount < 30 && cssCount < 15;
            addResult('automated', 'Performance Check', passed,
                `Scripts: ${scriptCount}, CSS: ${cssCount} ${passed ? '(Optimized)' : scriptCount === 0 ? '(No scripts detected)' : '(Too many files)'}`);
        }

        function testSecurity() {
            const externalLinks = document.querySelectorAll('a[target="_blank"]');
            let secureLinks = true;
            
            if (externalLinks.length === 0) {
                // No external links to test, consider it secure
                secureLinks = true;
            } else {
                secureLinks = Array.from(externalLinks).every(link => 
                    link.getAttribute('rel')?.includes('noopener')
                );
            }
            
            addResult('automated', 'Security Check', secureLinks,
                externalLinks.length === 0 ? 'No external links found (secure)' :
                secureLinks ? 'External links secured' : 'External links need security attributes');
        }

        function runAllTests() {
            clearResults();
            
            document.getElementById('overall-status').innerHTML = 
                '<div class="test-result info">üîÑ Running all tests...</div>';
            
            setTimeout(() => {
                // Critical tests
                testForgotPassword();
                testSessionManagement();
                testAccessibility();
                testRateLimiting();
                
                // Medium priority tests
                testRoleWizard();
                testAccountSettings();
                testHelpCenter();
                
                // Low priority tests
                testResponsive();
                testErrorHandling();
                testLoadingStates();
                
                // Automated tests
                runWebsiteValidator();
                testPerformance();
                testSecurity();
                
                document.getElementById('overall-status').innerHTML = 
                    '<div class="test-result pass">‚úÖ All tests completed! Check results below.</div>';
            }, 500);
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            // Wait for all scripts to load
            setTimeout(() => {
                document.getElementById('overall-status').innerHTML = 
                    '<div class="test-result info">üöÄ Test runner ready! All components loaded. Click "Run All Tests" to begin.</div>';
                
                // Auto-run tests after a short delay
                setTimeout(() => {
                    runAllTests();
                }, 2000);
            }, 1000);
        });
    </script>
</body>
</html>
